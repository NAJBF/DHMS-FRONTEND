<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - DHMS</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- QR Code Library (MUST be loaded first) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <h2>Student</h2>
            </div>
            <div class="user-info">
                <img id="studentPhoto" src="" alt="Student Photo">
                <div>
                    <h4 id="studentName">John Student</h4>
                    <small id="studentIdDisplay">ugr/1200/18 â€¢ 1st Year</small>
                    <div class="campus-status">
                        <span id="campusStatus" class="status-badge status-in-campus">In Campus</span>
                    </div>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <ul>
                <li><a href="#" onclick="showSection('welcome')" class="active"><i class="fas fa-home"></i>
                        Dashboard</a></li>
                <li><a href="#" onclick="showSection('photo')"><i class="fas fa-camera"></i> Upload Photo</a></li>
                <li><a href="#" onclick="showSection('room')"><i class="fas fa-bed"></i> My Room</a></li>
                <li><a href="#" onclick="showSection('maintenance')"><i class="fas fa-wrench"></i> Maintenance</a></li>
                <li><a href="#" onclick="showSection('laundry')"><i class="fas fa-tshirt"></i> Laundry</a></li>
                <li><a href="#" onclick="showSection('penalties')"><i class="fas fa-exclamation-triangle"></i>
                        Penalties</a></li>
            </ul>
        </nav>

        <div class="sidebar-footer">
            <button onclick="logout()" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navigation -->
        <header class="top-nav">
            <div class="nav-left">
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h3>Student Dashboard</h3>
            </div>
            <div class="nav-right">
                <span id="currentSection">Welcome</span>
            </div>
        </header>

        <!-- Dashboard Content -->
        <main class="content">
            <!-- Welcome Section -->
            <div id="welcomeSection" class="section active-section">
                <div class="card">
                    <div class="card-body">
                        <h2 id="welcomeHeading">Welcome, Student!</h2>
                        <p>Select an option from the sidebar to get started.</p>

                        <div class="quick-stats">
                            <div class="stat-card">
                                <i class="fas fa-bed"></i>
                                <h3>Room 204</h3>
                                <p>Unity Dorm</p>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-exclamation-triangle"></i>
                                <h3 id="activePenaltiesCount">0</h3>
                                <p>Active Penalty</p>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-map-marker-alt"></i>
                                <h3 id="campusStatusText">In Campus</h3>
                                <p>Current Status</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Room Information -->
            <div id="roomSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>My Room Details</h3>
                    </div>
                    <div class="card-body">
                        <div class="room-details">
                            <div class="detail">
                                <label>Room Number:</label>
                                <p><strong>204</strong></p>
                            </div>
                            <div class="detail">
                                <label>Dormitory:</label>
                                <p><strong>Unity Dorm (Male)</strong></p>
                            </div>
                            <div class="detail">
                                <label>Roommate:</label>
                                <p><strong>John Smith (ugr/1201/18)</strong></p>
                            </div>
                            <div class="detail">
                                <label>Check-in Date:</label>
                                <p><strong>September 1, 2024</strong></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Maintenance Request -->
            <div id="maintenanceSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>Submit Maintenance Request</h3>
                    </div>
                    <div class="card-body">
                        <form id="maintenanceForm">
                            <div class="form-group">
                                <label>Issue Type</label>
                                <select class="form-control" id="issueType" required>
                                    <option value="">Select issue type</option>
                                    <option value="plumbing">Plumbing</option>
                                    <option value="electrical">Electrical</option>
                                    <option value="furniture">Furniture</option>
                                    <option value="hvac">HVAC/Heating</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" class="form-control" id="issueTitle"
                                    placeholder="Brief title for the issue..." required>
                            </div>

                            <div class="form-group">
                                <label>Description</label>
                                <textarea class="form-control" id="issueDescription"
                                    placeholder="Describe the issue in detail..." required></textarea>
                            </div>

                            <div class="form-group">
                                <label>Urgency</label>
                                <select class="form-control" id="urgency">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Submit Request
                            </button>
                        </form>

                        <!-- Maintenance Requests Status -->
                        <div class="mt-4" id="maintenanceRequestsContainer">
                            <h4>My Maintenance Requests</h4>
                            <div id="maintenanceRequests">
                                <div class="status-card" id="noRequestsMessage">
                                    <p>No maintenance requests submitted yet.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Laundry Form -->
            <div id="laundrySection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>Submit Laundry Form</h3>
                    </div>
                    <div class="card-body">
                        <form id="laundryForm">
                            <div class="form-group">
                                <label>Number of Items</label>
                                <input type="number" class="form-control" id="itemCount" min="1" max="15" value="5"
                                    required>
                            </div>

                            <div class="form-group">
                                <label>Item List</label>
                                <textarea class="form-control" id="itemList"
                                    placeholder="List your items (e.g., 3 shirts, 2 pants)..." required></textarea>
                            </div>

                            <div class="form-group">
                                <label>Special Instructions (Optional)</label>
                                <textarea class="form-control" id="specialInstructions"
                                    placeholder="Any special handling instructions..."></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Submit Form
                            </button>
                        </form>

                        <!-- Active QR Codes Section -->
                        <div id="activeQRCodes" class="mt-4">
                            <!-- Active QR codes will be dynamically inserted here -->
                        </div>

                        <!-- Laundry Requests Status -->
                        <div class="mt-4" id="laundryRequestsContainer">
                            <h4>My Laundry Forms</h4>
                            <div id="laundryRequests">
                                <div class="status-card" id="noLaundryMessage">
                                    <p>No laundry forms submitted yet.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Penalties -->
            <div id="penaltiesSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>My Penalties</h3>
                    </div>
                    <div class="card-body">
                        <div id="penaltiesContainer">
                            <table class="table" id="penaltiesTable">
                                <thead>
                                    <tr>
                                        <th>Penalty ID</th>
                                        <th>Date</th>
                                        <th>Reason</th>
                                        <th>Duration</th>
                                        <th>End Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="penaltiesBody">
                                    <tr id="noPenaltiesRow">
                                        <td colspan="6" style="text-align: center;">No penalties assigned yet.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Photo Upload Section -->
            <div id="photoSection" class="section" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h3>Upload Profile Photo</h3>
                    </div>
                    <div class="card-body">
                        <div class="photo-upload-container">
                            <div class="current-photo">
                                <h4>Current Photo</h4>
                                <div class="photo-preview">
                                    <img id="currentPhotoPreview" src="" alt="Current Photo">
                                    <div class="photo-placeholder" id="noPhotoMessage">
                                        <i class="fas fa-user-circle"></i>
                                        <p>No photo uploaded yet</p>
                                    </div>
                                </div>
                            </div>

                            <div class="upload-form">
                                <h4>Upload New Photo</h4>
                                <form id="photoUploadForm">
                                    <div class="form-group">
                                        <label for="photoInput">Select Photo</label>
                                        <input type="file" class="form-control" id="photoInput" accept="image/*"
                                            required>
                                        <small class="form-text text-muted">
                                            Supported formats: JPG, PNG, GIF. Max size: 2MB.
                                        </small>
                                    </div>

                                    <div class="form-group">
                                        <label>Photo Preview</label>
                                        <div class="photo-preview-upload">
                                            <img id="photoPreview" src="" alt="Preview" style="display: none;">
                                            <div class="preview-placeholder">
                                                <i class="fas fa-image"></i>
                                                <p>Preview will appear here</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="upload-buttons">
                                        <button type="button" class="btn btn-secondary" onclick="cancelPhotoUpload()">
                                            <i class="fas fa-times"></i> Cancel
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-upload"></i> Upload Photo
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="photo-instructions mt-4">
                            <h5><i class="fas fa-info-circle"></i> Instructions</h5>
                            <ul>
                                <li>Upload a clear, recent photo of yourself</li>
                                <li>Photo should show your full face clearly</li>
                                <li>Only upload a photo once - it cannot be changed later</li>
                                <li>This photo will be used for identification purposes</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>&copy; 2024 AAU - Student Portal</p>
        </footer>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Laundry Exit QR Code</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="qr-code-container">
                    <div id="qrcode"></div>
                    <p class="qr-info">Show this QR code to security when leaving campus</p>
                    <div class="qr-details">
                        <p><strong>Form ID:</strong> <span id="qrFormId">LAU-001</span></p>
                        <p><strong>Student:</strong> <span id="qrStudentName">John Student</span></p>
                        <p><strong>Items:</strong> <span id="qrItemCount">5 items</span></p>
                        <p><strong>Generated:</strong> <span id="qrTimestamp">Just now</span></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="printQRCode()">
                    <i class="fas fa-print"></i> Print QR Code
                </button>
                <button class="btn btn-primary" onclick="saveQRCode()">
                    <i class="fas fa-download"></i> Save QR Code
                </button>
                <button class="btn btn-danger" onclick="closeQRModal()">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <!-- Test Button for QR Code (Remove in production) -->
    <button onclick="testQR()"
        style="position: fixed; bottom: 20px; right: 20px; z-index: 1000; padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
        Test QR Code
    </button>

    <script>
        // Force QRCode to load first
        if (typeof QRCode === 'undefined') {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"><\/script>');
        }
    </script>
    <script src="js/common.js"></script>
    <script src="js/student.js"></script>
</body>

</html>